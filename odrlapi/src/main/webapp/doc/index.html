<!doctype html>
<html>
    <head>
        <title>odrlapi</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="shortcut icon" href="favicon.png">         
        <!--        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" integrity="sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M" crossorigin="anonymous">        -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.4/cerulean/bootstrap.min.css" >
        <link rel="stylesheet" href="css/ladda-themeless.min.css"> <!-- http://msurguy.github.io/ladda-bootstrap/ -->
        <script src="js/spin.min.js"></script>
        <script src="js/ladda.min.js"></script>    
    </head>
    <body>
        <div class="container">
            <div class="page-header">
                <h1>ODRL Implementation</h1> 
                <p>The <a href="https://www.w3.org/2016/poe/">W3C Permissions and Obligations Expression</a> (POE) Working Group has been chartered 
                    to create recommendations for expressing permissions and obligations statements for digital content.
                    Try the API <a href="apidoc/index.html">here</a>!. <!--See also the <a href="http://w3c.github.io/poe/vocab/ODRL22.ttl">onto</a>. --> </p>
            </div>
        </div>        
        <div class="container">
            <div class="col-md-1">
            </div>
            <div class="col-md-10">
            </div>
            <div class="panel panel-default"> 
                <div class="panel-header"><h3>ODRL Validator and Evaluator Sandbox</h3></div>
                <div class="panel-body">
                
                    <div class="form-group">
                        <div class="col-xs-2">                        
                        
                    <b>JSON-LD</b><br/>
                        
                            <select id="sample2json" onchange="samplejson()">
                                <option>sample000.json</option>
                                <option>sample001.json</option>
                                <option>sample002.json</option>
                                <option>sample003.json</option>
                                <option>sample004.json</option>
                                <option>sample005.json</option>
                                <option>sample006.json</option>
                                <option>sample007.json</option>
                                <option>sample009.json</option>
                                <option>sample010.json</option>
                                <option>sample011.json</option>
                                <option>sample012.json</option>
                                <option>sample013.json</option>
                                <option>sample014.json</option>
                                <option>sample015.json</option>
                                <option>sample016.json</option>
                                <option>sample017.json</option>
                                <option>sample018.json</option>
                                <option>sample019.json</option>
                                <option>sample020.json</option>
                                <option>sample021.json</option>
                                <option>sample022.json</option>
                                <option>sample023.json</option>
                                <option>sample024.json</option>
                                <option>sample025.json</option>
                                <option>sample026.json</option>
                                <option>sample027.json</option>
                                <option>sample028.json</option>
                                <option>sample029.json</option>
                                <option>sample030.json</option>
                                <option>sample031.json</option>
                                <option>sample032.json</option>
                                <option>sample033.json</option>
                                <option>sample034.json</option>
                                <option>sample035.json</option>
                                <option>sample036.json</option>
                                <option>sample037.json</option>
                                <option>sample038.json</option>
                                <option>sample039.json</option>
                                <option>sample040.json</option>
                                <option>sample041.json</option>
                                <option>sample042.json</option>
                                <option>sample043.json</option>
                                <option>sample044.json</option>
                                <option>sample045.json</option>
                                <option>sample046.json</option>
                                <option>sample047.json</option>
                                <option>sample048.json</option>
                                <option>sample050.json</option>
                                <option>sample051.json</option>
                                <option>sample052.json</option>
                                <option>sample053.json</option>
                                <option>sample054.json</option>
                                <option>sample055.json</option>
                                <option>sample056.json</option>
                                <option>sample061.json</option>
                                <option>sample063.json</option>
                                <option>sample064.json</option>
                                <option>sample065.json</option>
                                <option>sample066.json</option>
                                <option>sample067.json</option>
                                <option>sample068.json</option>
                                <option>sample069.json</option>
                                <option>sample070.json</option>
                                <option>sample071.json</option>
                                <option>sample072.json</option>
                                <option>sample073.json</option>
                                <option>sample074.json</option>
                                <option>sample075.json</option>
                                <option>sample076.json</option>
                                <option>sample077.json</option>
                            </select>                        
                     <br/>
                    <b>Turtle</b><br/>
                            <select id="sample2" onchange="sample()">
                                <option>sample000</option>
                                <option>sample001</option>
                                <option>sample002</option>
                                <option>sample003</option>
                                <option>sample004</option>
                                <option>sample005</option>
                                <option>sample006</option>
                                <option>sample007</option>
                                <option>sample008</option>
                                <option>sample009</option>
                                <option>sample010</option>
                                <option>sample011</option>
                                <option>sample012</option>
                                <option>sample013</option>
                                <option>sample014</option>
                                <option>sample015</option>
                                <option>sample016</option>
                                <option>sample017</option>
                                <option>sample018</option>
                                <option>sample019</option>
                                <option>sample020</option>
                                <option>sample021</option>
                                <option>sample022</option>
                                <option>sample023</option>
                                <option>sample024</option>
                                <option>sample025</option>
                                <option>sample026</option>
                                <option>sample027</option>
                                <option>sample028</option>
                                <option>sample029</option>
                                <option>sample030</option>
                                <option>sample031</option>
                                <option>sample032</option>
                                <option>sample033</option>
                                <option>sample034</option>
                                <option>sample035</option>
                                <option>sample036</option>
                                <option>sample037</option>
                                <option>sample038</option>
                                <option>sample039</option>
                                <option>sample040</option>
                                <option>sample041</option>
                                <option>sample042</option>
                                <option>sample043</option>
                                <option>sample044</option>
                                <option>sample045</option>
                                <option>sample046</option>
                                <option>sample047</option>
                                <option>sample048</option>
                                <option>sample049</option>
                                <option>sample050</option>
                                <option>sample051</option>
                                <option>sample052</option>
                                <option>sample053</option>
                                <option>sample054</option>
                                <option>sample055</option>
                                <option>sample056</option>
                                <option>sample057</option>
                                <option>sample058</option>
                                <option>sample059</option>
                                <option>sample060</option>
                                <option>sample061</option>
                                <option>sample062</option>
                                <option>sample063</option>
                                <option>sample064</option>
                                <option>sample065</option>
                                <option>sample066</option>
                                <option>sample067</option>
                                <option>sample068</option>
                                <option>sample069</option>
                                <option>sample070</option>
                                <option>sample071</option>
                                <option>sample072</option>
                                <option>sample073</option>
                                <option>sample074</option>
                                <option>sample075</option>
                                <option>sample076</option>
                                <option>sample077</option>
                                <option>sample078</option>
                            </select>                        
                        </div>
                    
                        <div class="col-xs-8"><textarea style="font-size:small;font-family:monospace;" class="form-control" rows="14" id="pgn" name="pgn"></textarea></div>
                        <div class="col-xs-2">
                            <center>
                                <a id="boton2" class="btn btn-primary ladda-button" data-style="zoom-in" href="javascript: submitform2()"><span class="ladda-label">Validate </span><span class="glyphicon glyphicon-chevron-right"></span></a>
                                <p></p>
                            </center>
                            <center>
                                <a id="boton1" class="btn btn-primary ladda-button disabled" data-style="zoom-in" href="javascript: submitform1()"><span class="ladda-label">Evaluate </span><span class="glyphicon glyphicon-chevron-right"></span></a>
                                <p></p>
                            </center>
                            <!--<center>
                                <a id="boton3" class="btn btn-primary ladda-button disabled" data-style="zoom-in" href="javascript: submitform3()"><span class="ladda-label">Transcode </span><span class="glyphicon glyphicon-chevron-right"></span></a>
                                <p></p> 
                            </center> -->
                        </div>
                    </div>
                    <small>The first validation takes ~20 sec.</small>
                </div>
            </div>
            <p id="salida" class="bg-info" style="font-family:monospace;">No output</p>

        </div>            

        <p style="margin-bottom:3cm;">.</p>
        <!--        <div id="footer" style="position:fixed;bottom:0;text-align:left;font-size:smaller;"> -->
        <div id="footer" style="text-align:center;font-size:smaller;margin-bottom:3cm;"> 
            <div class="container">
                <p > 
                    This work is an independent initiative, not endorsed whatsoever by the W3C. Open source hosted at <a href="https://github.com/oeg-upm/licensius/tree/master/odrlapi">github</a> - Victor Rodriguez Doncel - <a href="http://www.oeg-upm.net">OEG</a> - Universidad Polit√©cnica de Madrid 2017
                </p>
            </div>
        </div>
        <!--
                <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
                <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>
                <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js" integrity="sha384-h0AbiXch4ZDo7tp9hKZ4TsHbi047NrKGLO3SEJAg45jXxnGIfYzk4Si90RDIqNm1" crossorigin="anonymous"></script>        
        -->
        <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" crossorigin="anonymous"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js" crossorigin="anonymous"></script>        
        <script type="text/javascript">
                                // Loads a file with a sample into the textarea for the user to standard texts
                                function sample()
                                {
                                    var v = document.getElementById("sample2");
                                    var archivo = v.options[v.selectedIndex].text;
                                    console.log(archivo);
                                    var client = new XMLHttpRequest();
                                    client.open('GET', '/samples/' + archivo);
                                    client.onreadystatechange = function () {
                                        //alert(client.responseText);
                                        document.getElementById('pgn').value = client.responseText;
                                    }
                                    client.send();
                                }

                                // Loads a file with a sample into the textarea for the user to standard texts
                                function samplejson()
                                {
                                    var v = document.getElementById("sample2json");
                                    var archivo = v.options[v.selectedIndex].text;
                                    console.log(archivo);
                                    var client = new XMLHttpRequest();
                                    client.open('GET', '/samples/' + archivo);
                                    client.onreadystatechange = function () {
                                        //alert(client.responseText);
                                        document.getElementById('pgn').value = client.responseText;
                                    }
                                    client.send();
                                }

                                //enrich
                                function submitform1()
                                {
                                    console.info("test");
                                    var l = Ladda.create(document.getElementById("boton1"));
                                    l.start();
                                    var http = new XMLHttpRequest();
                                    var pgn = document.getElementById("pgn").value;
                                    var pgnencoded = encodeURI(pgn);
                                    console.info(pgn);
                                    var params = "pgn=" + pgnencoded + "&action=enrich";
                                    http.open("GET", "/test", true); //true
                                    http.setRequestHeader("Content-type", "application/x-www-form-urlencoded;charset=UTF-8");
                                    http.setRequestHeader("Content-length", params.length);
                                    http.setRequestHeader("Connection", "close");
                                    http.send(params);
                                    http.onload = function () {
                                        console.info(http.responseText);
//                    document.getElementById("rdf").value = http.responseText;
                                        document.getElementById("salida").innerHTML = http.responseText;
                                        l.stop();
                                    }
                                }
                                var entityMap = {
                                    '&': '&amp;',
                                    '<': '&lt;',
                                    '>': '&gt;',
                                    '"': '&quot;',
                                    "'": '&#39;',
                                    '/': '&#x2F;',
                                    '`': '&#x60;',
                                    '=': '&#x3D;'
                                };

                                function escapeHtml(string) {
                                    return String(string).replace(/[&<>"'`=\/]/g, function (s) {
                                        return entityMap[s];
                                    });
                                }
                                //Validation
                                function submitform2()
                                {
                                    var l = Ladda.create(document.getElementById("boton2"));
                                    l.start();
                                    var http = new XMLHttpRequest();
                                    var pgn = document.getElementById("pgn").value;
                                    http.open("POST", "/validator", true); //true
                                    http.setRequestHeader("Content-type", "text/turtle");
                                    http.send(pgn);
                                    http.onload = function () {
                                        var res = http.responseText;
                                        console.info(res);
                                        res = res.replace("\n", "TOPRINT")
                                        res = res.replace("\\n", "TOPRINT")
                                        var obj = JSON.parse(res);
                                        var text = obj.text;
                                        var status = obj.status;
                                        var toprint = escapeHtml(text);
                                        console.info("Antes:"+toprint);
                                        toprint = toprint.replace("TOPRINT", "<BR>");
                                        console.info("Tras :"+toprint);
                                        document.getElementById("salida").innerHTML = toprint;
                                        
                                        var n = res.indexOf("200");
                                        if (status === 200)
                                        {
                                            console.info("BUENO");
                                            document.getElementById("salida").setAttribute("class", "bg-success");
                                        } else
                                        {
                                            console.info("MALO");
                                            document.getElementById("salida").setAttribute("class", "bg-danger");
                                        }
                                        l.stop();
                                    }
                                }
        </script>

    </body>
</html>
