<!DOCTYPE html>
<html>
 <head>
  <title>Conditional Linked Data</title>
  <meta charset="utf-8">
  <meta name="author" content="Victor Rodriguez Doncel, Daniel Vila Suero"/>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="/css/vroddon.css">
  <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css"> 
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
  <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
  <script src="/js/bootbox.min.js"></script>

  
 </head>
<body>
	
<nav class="navbar navbar-inverse navbar-fixed-top">
  <div class="container-fluid">
    <div class="navbar-header">
      <a class="navbar-brand" href="/">
	  <img src="/img/rdf-condicional.png" width="24" style="float:left;margin:0px"/ > Conditional Linked Data
	  </a>
    </div>
    <div>
      <ul class="nav navbar-nav">
        <li><a href="/user">Demo User</a></li>
        <li><a href="/admin">Demo Manager</a></li> 
        <li><a href="/develop.html">Develop</a></li> 
      </ul>
	   <ul class="nav navbar-nav navbar-right">
        <li><a href="/account"><span class="glyphicon glyphicon-log-in"></span> Account</a></li>
      </ul>
    </div>
  </div>
</nav>
	
	
<div class="container">
 <div class="jumbotron">
	<center><h1>Conditional Linked Data</h1> 
    <p>A policy-based linked data server </p></center>
 </div>	
  <div class="col-md-2">
  </div>
  <div class="col-md-9">
<!--
<div class="ldrheading"><p>What is Conditional Linked Data?</p></div>
<p class="lead"><strong>Conditional Linked Data</strong> serves conditional Linked Data with access control based on ODRL policies. These pages demonstrate the <strong>conditional access to Linked Data</strong> </p>
-->

<div class="ldrheading"><p>Manage datasets</p></div>

<div class="panel panel-default">
<div class="panel-body">
<table class="table ">
  <col width="10%">
  <col width="10%">
  <col width="65%">
  <col width="15%">
    <thead>
      <tr>
        <th>Short</th>
        <th>Resources</th>
        <th>Description</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
<!--TEMPLATEDATASETS-->	
    </tbody>
  </table>
<!--TEMPLATEADDITIONALPORTALBUTTONS-->  
  
  
  </div>
</div>
</div> <!-- fin del espacio grande -->
  
  <div class="col-md-1">
  </div>
  
 
</div> <!-- fin de el container-->
  
<footer style="margin-top: 30px">
	<p><center><small> <a href="http://www.oeg-upm.net">2015 Ontology Engineering Group</a> - Universidad Politecnica de Madrid - All Rights Reserved. Attribution of data shown in this page is given in the about page</small></center></p>
</footer>


<script type="text/javascript">
var seldataset = '';
function submitRebase(dataset)
{
	console.info('Rebase dataset');
	bootbox.prompt({
		title: "What is the original URL to be rebased?",
		value: "http://",
		callback: function(result) {
		if (result === null) {
//			Example.show("Prompt dismissed");
		} else {
		var params="&dataset="+dataset;
		params+="&uri="+result;
		$("body").css("cursor", "progress");
		var http = new XMLHttpRequest();
		http.open("POST", "/service/datasetRebase", true); //true
		http.onreadystatechange=function()
		{
			location.reload();
			$("body").css("cursor", "default");	
		}		
		http.setRequestHeader("Content-type","application/x-www-form-urlencoded;charset=UTF-8");
		http.setRequestHeader("Content-length", params.length);    
		http.setRequestHeader("Connection", "close");
		http.send(params);
		}
  }
});
}
function submitEdit(dataset, action)
{
	console.info('Edit dataset');
	seldataset=dataset;
	$('#editDataset').modal('show');
}
function submitRemove(dataset)
{
	console.info("Removing dataset: " +dataset);
	bootbox.confirm("You are going to delete the dataset " + dataset + "<br>Are you sure?", function(result) {
		console.info('el resultado ha sido ' + result);
		if (result=='false' || result==false)
			return;
		$("body").css("cursor", "progress");	
		var params="&dataset="+dataset;
		var http = new XMLHttpRequest();
		http.open("POST", "/service/datasetRemove", true); //true
		http.onreadystatechange=function()
		{
			location.reload();
			$("body").css("cursor", "default");	
		}		
		http.setRequestHeader("Content-type","application/x-www-form-urlencoded;charset=UTF-8");
		http.setRequestHeader("Content-length", params.length);    
		http.setRequestHeader("Connection", "close");
		http.send(params);
	}); 		
}
function submitIndex(dataset)
{
	console.info("Indexing dataset: " +dataset);
	bootbox.confirm("You are going to index the dataset " + dataset + "<br>This may be a lengthy operation. <b>Are you sure?</b>", function(result) {
		console.info('el resultado ha sido ' + result);
		if (result=='false' || result==false)
			return;
		$("body").css("cursor", "progress");	
		var params="&dataset="+dataset;
		var http = new XMLHttpRequest();
		http.open("POST", "/service/datasetIndex", true); //true
		http.onreadystatechange=function()
		{
			location.reload();
			$("body").css("cursor", "default");	
		}		
		http.setRequestHeader("Content-type","application/x-www-form-urlencoded;charset=UTF-8");
		http.setRequestHeader("Content-length", params.length);    
		http.setRequestHeader("Connection", "close");
		http.send(params);
	}); 		
}

</script>  
  


<!-- DIALOGO PARA EDITAR EL DATASET -->
<div class="modal fade" id="editDataset" tabindex="-1" role="dialog" aria-labelledby="editDataset" aria-hidden="true">
  <div class="modal-dialog modal-md">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title" id="myModalLabel">Edit Dataset</h4>
      </div>
      <div class="modal-body">
        <h3>Edit Dataset</h3>

		  <div class="form-group">
			<label for="shortTitle">Short label</label>
			<input id="shortTitle" class="form-control" placeholder="Examples: 'geo', 'iate', 'apertium'" required>
		  </div>		
		  <div class="form-group">
			<label for="title">Title</label>
			<input id="title" class="form-control" placeholder="Examples: 'XYZ Terminology', 'A Dictionary of French'" required>
		  </div>		
		  <div class="form-group">
			<label for="description">Description</label>
			<textarea id="description" class="form-control" rows="3" placeholder="This dataset describes lore ipsum.." ></textarea>
		  </div>		

		  <div class="form-group">
			<label for="logo">Logo</label>
			<input type="file" name="afile" id="afile" accept="image/*"/>
			<div id="progreso"></div>
		  </div>
			
		  <div class="form-group">
			<label for="rdfdump">RDF Dump</label>
			<input type="file" name="afile2" id="afile2"/>
			<div id="progreso2"></div>
		  </div>
		  
		  
		  
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
        <button type="button" onclick="enviarDataset()" data-dismiss="modal" class="btn btn-primary">OK</button>
      </div>
    </div>
  </div>
</div>
<!-- FIN DEL DIALOGO PARA EL DATASET -->







 
<script>
//AJAX http://code.tutsplus.com/tutorials/uploading-files-with-ajax--net-21077
//JAVASCRIPT https://developer.tizen.org/dev-guide/2.2.1/org.tizen.web.appprogramming/html/tutorials/w3c_tutorial/comm_tutorial/upload_ajax.htm

document.querySelector('#afile').addEventListener('change', function(e) {
  var file = this.files[0];
  var fd = new FormData();
  seldataset = document.getElementById('shortTitle').value;
  console.info(seldataset);
  fd.append("dataset", seldataset);
  fd.append("afile", file);
  var xhr = new XMLHttpRequest();
  xhr.open('POST', 'service/logoUpload', true);
  xhr.upload.onprogress = function(e) {
    if (e.lengthComputable) {
      var percentComplete = (e.loaded / e.total) * 100;
	  document.getElementById('progreso').innerHTML = Math.round(percentComplete) + '% uploaded';
      console.log(percentComplete + '% uploaded');
    }
  };
  xhr.onload = function() {
    if (this.status == 200) {
//      var resp = JSON.parse(this.response);
      console.log('finished');
	  document.getElementById('progreso').innerHTML = '';
  
	  
   //   var image = document.createElement('img');
   //   image.src = resp.dataUrl;
   //   document.body.appendChild(image);
    };
  };

  xhr.send(fd);
}, false);
</script>


<script>
document.querySelector('#afile2').addEventListener('change', function(e) {
  var file = this.files[0];
  var fd = new FormData();
  seldataset = document.getElementById('shortTitle').value;
  console.info(seldataset);
  
  fd.append("dataset", seldataset);
  fd.append("afile2", file);
  var xhr = new XMLHttpRequest();
  xhr.open('POST', 'service/datasetUpload', true);
  xhr.upload.onprogress = function(e) {
    if (e.lengthComputable) {
      var percentComplete = (e.loaded / e.total) * 100;
	  document.getElementById('progreso2').innerHTML = Math.round(percentComplete) + '% uploaded';
      console.log(percentComplete + '% uploaded');
    }
  };
  xhr.onload = function() {
    if (this.status == 200) {
      console.log('finished');
	  document.getElementById('progreso2').innerHTML = '';
    }
	else
	{
		bootbox.dialog({
		  message: "Conversion could not be made",
		  title: "Error",
		  buttons: {
			danger: {
			  label: "OK",
			  className: "btn-danger",
			  callback: function() {
				Example.show("OK");
			  }
			}
		  }
		});	  	
	}
  };
  xhr.send(fd);
}, false);
</script>


	
<script> <!-- Este codigo se ejecuta cuando se abre el dialogo modal -->
var recipient = -1;
$('#editDataset').on('show.bs.modal', function (event) {
	var button = $(event.relatedTarget) // Button that triggered the modal
	//http://stackoverflow.com/questions/28774571/retrieving-table-row-information-using-ajax-and-pdo-to-display-in-bootstrap-moda
	var xmlhttp=new XMLHttpRequest(); 
	xmlhttp.onreadystatechange=function()
	{
		console.info('Received response from describeDataset');
		if (xmlhttp.readyState==4 && xmlhttp.status==200)
		{
			console.info('found');
			//document.getElementById("myDiv").innerHTML=xmlhttp.responseText;
			var json = JSON.parse( xmlhttp.responseText );
			document.getElementById('shortTitle').value=json.label;
			document.getElementById('title').value=json.title;
			document.getElementById('description').value=json.description;
		}
	}
	xmlhttp.open("GET","/service/describeDataset?dataset="+seldataset,true);
	xmlhttp.setRequestHeader( 'Content-Type', 'application/json' );	
	xmlhttp.send();	
})
function enviarDataset() {
		//este codigo se ejecuta cuando se ha dado al OK
		var label = document.getElementById("shortTitle").value;
		var description = document.getElementById("description").value;
		var title = document.getElementById("title").value;
		console.info(description);
		var params="dataset="+seldataset;
		params+="&title="+title;
		params+="&description="+description;
		params+="&newlabel="+label;
		var http = new XMLHttpRequest();
		http.onreadystatechange=function()
		{
			location.reload();
		}		
		http.open("POST", "/service/setDatasetMetadata", true); //true		
		http.setRequestHeader("Content-type","application/x-www-form-urlencoded;charset=UTF-8");
		http.setRequestHeader("Content-length", params.length);    
		http.setRequestHeader("Connection", "close");
		http.send(params);
}
</script>	

  
</body>
</html>