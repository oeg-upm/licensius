<html>
<!-- Victor Rodriguez Doncel - Ontology Engineering Group - Universidad Politecnica de Madrid (Spain) - 2014 -->
<head>
<title>Conditional access to Linked Data</title>
<meta content="text/html; charset=iso-8859-1" http-equiv=Content-Type/>
<meta name="description" content="OEG-UPM Demo on Conditional Access to Linked Data"/>
<meta name="author" content="Victor Rodriguez Doncel "/>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta http-equiv="content-type" content="Mime-Type; charset=iso-8859-1" />
<meta name="DC.title" content="Conditional access to linked data" />
<link rel="icon" href="/ldr/img/favicon.png" type="image/png" />
<link rel="stylesheet" type="text/css" href="/ldr/css/buttons.css">
<link rel="stylesheet" type="text/css" href="/ldr/css/style.css">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-49063507-1', 'linkeddata.es');
  ga('send', 'pageview');
</script>

  <script type="text/javascript">
  (function() {
    var po = document.createElement('script');
    po.type = 'text/javascript'; po.async = true;
    po.src = 'https://plus.google.com/js/client:plusone.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(po, s);
  })();
  </script>
  <!-- JavaScript specific to this application that is not related to API
     calls -->
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js" ></script>

<script type="text/javascript">
var helper = (function() {
  var authResult = undefined;

  return {
    /**
     * Hides the sign-in button and connects the server-side app after
     * the user successfully signs in.
     *
     * @param {Object} authResult An Object which contains the access token and
     *   other authentication information.
     */
    onSignInCallback: function(authResult) {
      $('#authResult').html('Auth Result:<br/>');
      for (var field in authResult) {
        $('#authResult').append(' ' + field + ': ' + authResult[field] + '<br/>');
      }
      if (authResult['access_token']) {
        // The user is signed in
        this.authResult = authResult;
        helper.connectServer();
        // After we load the Google+ API, render the profile data from Google+.
        gapi.client.load('plus','v1',this.renderProfile);
      } else if (authResult['error']) {
        // There was an error, which means the user is not signed in.
        // As an example, you can troubleshoot by writing to the console:
        console.log('There was an error: ' + authResult['error']);
        $('#authResult').append('Logged out');
        $('#authOps').hide('slow');
        $('#gConnect').show();
      }
      console.log('authResult', authResult);
    },
    /**
     * Retrieves and renders the authenticated user's Google+ profile.
     */
    renderProfile: function() {
      var request = gapi.client.plus.people.get( {'userId' : 'me'} );
      request.execute( function(profile) {
          $('#profile').empty();
          if (profile.error) {
            $('#profile').append(profile.error);
            return;
          }
          $('#profile').append(
              $('<p><img src=\"' + profile.image.url + '\"></p>'));
          $('#profile').append(
              $('<p>Hello ' + profile.displayName + '!<br />Tagline: ' +
              profile.tagline + '<br />About: ' + profile.aboutMe + '</p>'));
          if (profile.cover && profile.coverPhoto) {
            $('#profile').append(
                $('<p><img src=\"' + profile.cover.coverPhoto.url + '\"></p>'));
          }
        });
		
		gapi.client.load('oauth2', 'v2', function() {
		  gapi.client.oauth2.userinfo.get().execute(function(resp) {
			// Shows user email
			console.log(resp.email);
			 $('#idUsuario').empty();
			 $('#idUsuario').append(resp.email);
		  })
		});			
		
      $('#authOps').show('slow');
      $('#gConnect').hide();
    },
    /**
     * Calls the server endpoint to disconnect the app for the user.
     */
    disconnectServer: function() {
      // Revoke the server tokens
      $.ajax({
        type: 'POST',
        url: window.location.href + 'disconnect',
        async: false,
        success: function(result) {
          console.log('revoke response: ' + result);
          $('#authOps').hide();
          $('#profile').empty();
          $('#visiblePeople').empty();
          $('#authResult').empty();
          $('#gConnect').show();
        },
        error: function(e) {
          console.log(e);
        }
      });
			 $('#idUsuario').empty();
			 $('#idUsuario').append('guest');	  
    },
    /**
     * Calls the server endpoint to connect the app for the user. The client
     * sends the one-time authorization code to the server and the server
     * exchanges the code for its own tokens to use for offline API access.
     * For more information, see:
     *   https://developers.google.com/+/web/signin/server-side-flow
     */
    connectServer: function() {
      console.log(this.authResult.code);
      $.ajax({
        type: 'POST',
        url: window.location.href + 'connect?state={{ STATE }}',
        contentType: 'application/octet-stream; charset=utf-8',
        success: function(result) {
          console.log(result);
          helper.people();
        },
        processData: false,
        data: this.authResult.code
      });
    },
    /**
     * Calls the server endpoint to get the list of people visible to this app.
     */
    people: function() {
      $.ajax({
        type: 'GET',
        url: window.location.href + 'people',
        contentType: 'application/octet-stream; charset=utf-8',
        success: function(result) {
          helper.appendCircled(result);
        },
        processData: false
      });
    },
    /**
     * Displays visible People retrieved from server.
     *
     * @param {Object} people A list of Google+ Person resources.
     */
    appendCircled: function(people) {
      $('#visiblePeople').empty();

      $('#visiblePeople').append('Number of people visible to this app: ' +
          people.totalItems + '<br/>');
      for (var personIndex in people.items) {
        person = people.items[personIndex];
        $('#visiblePeople').append('<img src="' + person.image.url + '">');
      }
    },
  };
})();

/**
 * Perform jQuery initialization and check to ensure that you updated your
 * client ID.
 */
$(document).ready(function() {
  $('#disconnect').click(helper.disconnectServer);
  if ($('[data-clientid="YOUR_CLIENT_ID"]').length > 0) {
    alert('This sample requires your OAuth credentials (client ID) ' +
        'from the Google APIs console:\n' +
        '    https://code.google.com/apis/console/#:access\n\n' +
        'Find and replace YOUR_CLIENT_ID with your client ID and ' +
        'YOUR_CLIENT_SECRET with your client secret in the project sources.'
    );
  }
});

/**
 * Calls the helper method that handles the authentication flow.
 *
 * @param {Object} authResult An Object which contains the access token and
 *   other authentication information.
 */
function onSignInCallback(authResult) {
  helper.onSignInCallback(authResult);
}
</script>
  
</head>
<body>
<div class="container"> 

<!-- ENCABEZADO -->
<div class="sixteen columns">
<a href="/ldr/en/index.html"><img src="/ldr/img/rdf-condicional.png" style="width:70px;float:left;margin:8px;"/></a><h1 style="vertical-align:bottom">Conditional access to Linked Data</h1>
<h2 style="vertical-align:bottom">Account</h2>
<p class="vbottommini"></p>
</div>

<!-- MENU DE NAVEGACION -->
<div class="three columns alpha">
<div id="nav" class="menu_div"> 
<ul>
<li class="titulomenu">What is this?</li>
<li><a href="/ldr/en/index.html">Introduction</a></li>
<li><a href="/ldr/en/infotecnica.html">Technical details</a></li>
<li class="titulomenu">User's view (demo)</li>
<li><a href="/ldr/en/linkeddata.html">Browse dataset</a></li>
<li><a href="/ldr/en/datasets.html">Offers</a></li>
<li id="active"><a href="/ldr/en/account.html">Account</a></li>
<li class="titulomenu">Admin's view (demo)</li>
<li><a href="/ldr/manageren">Control panel</a></li>
<li ><a href="/ldr/en/accountability.html">Accountability</a></li>
</ul>
</div>
</div>



<div class="one column omega" style="visibility:hidden;">
.
</div>

<!-- CONTENIDO -->
<div class="twelve columns omega" >

Logged in as <strong>vroddon@gmail.com</strong></br>User: <strong>Victor Rodriguez Doncel</strong> <a href="/ldr/en/account.html?action=logout">logout</a><hr/>You have purchased the following permissions:<br/>

<table border="1" style="width:300px">
<tr><td>License</td><td>Asset</td></tr>
<tr><td>License1</td><td>Asset1</td></tr>
</table>




<p style="border:1px solid gray;width=250px;float:left"><img src="/ldr/img/llave16.png"/>ResearchSpain</p> <a href="http://salonica.dia.fi.upm.es/ldr/policy/ffaddba4-fc2e-4ee0-a784-e62f1db259ff">view</a><br/><p style="border:1px solid gray;width=250px;float:left"><img src="/ldr/img/llave16.png"/>License15euros</p> <a href="http://salonica.dia.fi.upm.es/ldr/policy/cdaddba4-fc2e-4ee0-a784-e62f1db259bf">view</a><br/><a href="/ldr/service/resetPortfolio"><button>Reset portfolio</button> </a><a href="/ldr/service/exportPortfolio?signed=false"><button>View portfolio</button></a><a href="/ldr/service/exportPortfolio?signed=true"><button>View signed portfolio</button></a>

</div>

<div class="sixteen columns">
<p style="margin-left: auto;margin-right: auto;"></p>
<p class="vbottom"></p>
<hr/>
<center><h4>Thanks for testing our technology</h4>
<p><small>These pages have been developed with the purpose of demonstrating the <a href="index.html">conditional access to Linked Data</a> 
		based on ODRL/LDR policies<br/>
 <a href="http://www.oeg-upm.net">2014 Ontology Engineering Group</a> - Universidad Politecnica de Madrid - All Rights Reserved</small></p>
<br><a href="http://www.oeg-upm.net"><img src="/ldr/img/oeg100.png"/></a></center>                    
</div>


            <!--<div class="sixteen columns">
                <p class="vbottom"></p>
                <hr/>
                <center>
                    <h4>Thanks for testing our technology</h4>
                    <small>
                        These pages have been developed with the purpose of demonstrating the <a href="/ldr/index.html">conditional access to Linked Data</a> 
                        based on ODRL/LDR policies<br/>
                        Ontology Engineering Group - Universidad Politecnica de Madrid
                    </small>
                </center>
                <center><br><a href="http://www.oeg-upm.net"><img src="/ldr/img/oeg100.png"/></a></center>
            </div> -->





</div>
<!-- We use cookies to enhance your experience. By continuing to visit this site you agree to our use of cookies. Learn more -->
<script type="text/javascript" id="cookiebanner" src="http://cookiebanner.eu/js/cookiebanner.min.js" data-message="We use cookies to enhance your experience. By continuing to visit this site you agree to our use of cookies."></script>

</body>
</html>